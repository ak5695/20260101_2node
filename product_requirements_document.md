# 产品需求文档 (PRD) - AI 节点式对话学习应用

## 1. 项目概述

### 1.1 产品名称
（ThinkTree，例如 "AI 思维导图学习助手"、"智能链式思考伴侣"）

### 1.2 产品愿景
打造一款革命性的 AI 对话学习工具，通过直观的节点式可视化界面，帮助用户在与 AI 交互过程中进行链式思考、深度理解、高效整理和知识管理，解决传统 AI 对话“一次性”、“难以追溯”、“缺乏结构化”的问题。

### 1.3 目标用户
学生、研究人员、内容创作者、开发者以及任何希望通过 AI 进行高效学习、深度思考和知识整理的用户。

### 1.4 核心价值主张
将 AI 对话的瞬时性转化为结构化的、可迭代的知识网络，赋能用户进行深度学习和创新思考。

## 2. 核心功能

### 2.1 节点式对话管理

#### 2.1.1 对话节点创建
*   **用户故事**：作为用户，我希望能够输入问题并获得 AI 的回答，以便开启一个新的思维探索路径。
*   **功能描述**：
    *   提供输入框供用户输入文本。
    *   发送请求至选定的 LLM 模型。
    *   接收流式（Streaming）响应并实时展示。
    *   将提问和完整回答封装为一个“节点”对象。**同时，AI 返回包含最小信息量提问（50字以内）和答案（100字以内），以及完整提问和答案。** (新增，实现: 2026-01-02)
*   **验收标准**：
    *   输入框支持多行文本，最大字符数限制为 4000。
    *   发送后显示“思考中”状态或加载动画。
    *   AI 回答必须实时打字机效果显示，而不是等待全部完成后一次性显示。
    *   节点创建成功后，包含：唯一 ID (UUID)、**最小信息量提问、最小信息量回答、完整提问、完整回答**、创建时间、更新时间、所属工作区 ID、使用的模型标识。(修改，实现: 2026-01-02)

#### 2.1.2 节点内容交互（展开/收起/查看）
*   **用户故事**：作为用户，我希望默认只看到节点的摘要，以便在概览视图中掌握整体脉络；~~点击后能查看详情~~。(修改，实现: 2026-01-02)
*   **功能描述**：
    *   默认状态：显示问题的前 50 个字符和回答的前 100 个字符。节点本身固定大小 `320px` 宽，`180px` 高，内容超出时显示滚动条。(修改，实现: 2026-01-02)
    *   ~~展开状态：显示完整内容。~~ (删除: 2026-01-02)
    *   Markdown 渲染：支持代码块、列表、粗体等 Markdown 格式的渲染。(提出: 2026-01-02, 实现: 2026-01-02)
*   **验收标准**：
    *   ~~点击节点头部或“展开”图标切换状态。~~ (删除: 2026-01-02)
    *   ~~展开/收起要有平滑的 CSS 过渡动画（<300ms）。~~ (删除: 2026-01-02)
    *   代码块应支持语法高亮和“复制”按钮。(提出: 2026-01-02, 实现: 2026-01-02)

#### 2.1.3 链式思考与子节点创建（核心）
*   **用户故事**：作为用户，我希望能针对 AI 回答中的特定点进行追问，并在视觉上建立连接，以便进行深度的链式思考。
*   **功能描述**：
    *   **文本选区交互**：用户在父节点的回答中选中一段文本后，在**选区末尾的右下角**自动出现一个悬浮菜单，包含“添加节点(+)”和“标记(Mark)”按钮。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **标记 (Mark)**：点击“标记”按钮，选中的文本背景颜色变为~~橙色（例如 `#d19a66`）~~绿色（例如 `#10b981`），且这种高亮状态在节点内持久化显示。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **添加节点 (+) 与拖拽连线**：
        *   点击“+”号，鼠标位置出现一条动态连线和“准节点”。用户可通过拖拽鼠标来调整连线长度和新节点位置。(提出: 2026-01-02, 实现: 2026-01-02)
        *   若鼠标指向另一个已有节点，连线应自动磁吸（Snap）到该节点的左侧，完成节点间的重连或建立新关联。(提出: 2026-01-02, 实现: 2026-01-02)
        *   点击确认位置后，在鼠标位置生成新节点。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **动态连线起点**：
        *   连线的起点应为父节点内被选中文本的**精确末尾位置**。(提出: 2026-01-02, 实现: 2026-01-02)
        *   不同文字对应不同的连线起点（类似 Word 批注布局）。(提出: 2026-01-02, 实现: 2026-01-02)
        *   当节点被折叠 (Collapsed) 时，所有从该节点引出的连线起点应汇聚到节点的右侧中心或默认 Handle 位置。(提出: 2026-01-02, 实现: 2026-01-02)
*   **验收标准**：
    *   选中操作响应灵敏，取消选中（点击空白处）时按钮消失。(提出: 2026-01-02, 实现: 2026-01-02)
    *   连线样式：起点圆点，终点箭头，平滑贝塞尔曲线。(提出: 2026-01-02, 实现: 2026-01-02)
    *   拖拽交互流畅，磁吸效果明显。(提出: 2026-01-02, 实现: 2026-01-02)

#### 2.1.4 节点编辑与交互（增强）
*   **用户故事**：作为用户，我希望能够快速修改问题并重新获得答案，或者仅仅是修正文本。
*   **功能描述**：
    *   **双击编辑**：用户双击节点的问题文本区域，进入编辑模式（变为 Textarea）。**在节点详情大窗口中双击提问，可编辑完整提问。** (修改，实现: 2026-01-02)
    *   **回车即时生成**：在问题编辑模式下，按下 `Enter` 键（非 `Shift+Enter`）触发保存并**立即调用 AI 接口流式重新生成该节点的答案。编辑完整提问后，AI 自动重新生成最小信息量提问和答案。** (修改，实现: 2026-01-02)
    *   **节点右键菜单 (Context Menu)**：右键点击节点，弹出菜单，包含：
        *   **删除节点**：支持乐观更新逻辑，界面立即移除节点，后端异步执行。(提出: 2026-01-02, 实现: 2026-01-02)
        *   **复制 ID**：方便开发调试或高级引用。(提出: 2026-01-02, 实现: 2026-01-02)
        *   **复制完整内容**：在节点详情大窗口中，选中 AI 回答中的文本后，悬浮菜单出现“复制”按钮。(新增，实现: 2026-01-02)
*   **验收标准**：
    *   双击响应灵敏。(提出: 2026-01-02, 实现: 2026-01-02)
    *   编辑框自动聚焦。(提出: 2026-01-02, 实现: 2026-01-02)
    *   重新生成时，该节点及其下游节点的状态应如何变化（需定义：如下游节点是否也级联更新？目前建议仅更新当前节点，下游节点保留或标记为“过时”）。(提出: 2026-01-02, 实现: 2026-01-02)

#### 2.1.5 智能布局与整理
*   **用户故事**：作为用户，我希望画布始终保持整洁，且能一键归位。
*   **功能描述**：
    *   **Tidy Up (自动整理)**：点击 Dock 栏上的 "Tidy Up" 按钮，系统集成 **Dagre** 或 **ELKjs** 布局引擎，根据节点间的父子连接关系自动计算最优坐标，并以动画过渡的方式重新排列节点。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **Zoom to Fit**：点击 Dock 栏上的 "Zoom to Fit" 按钮，自动缩放和平移画布，使所有节点以最佳比例显示在视口中央。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **自动保存 (Auto-save)**：用户的任何操作（节点移动、编辑、缩放、新增）都会触发静默的自动保存。(提出: 2026-01-02, 实现: 2026-01-02)
*   **验收标准**：
    *   Tidy Up 过程应有动画过渡，让用户感知位置变化。(提出: 2026-01-02, 实现: 2026-01-02)
    *   Zoom to Fit 应留有适当的边距 (Padding)，例如 50px。(提出: 2026-01-02, 实现: 2026-01-02)
    *   自动保存应有防抖 (Debounce) 机制，避免请求过于频繁，界面右上角显示“已保存”状态指示。(提出: 2026-01-02, 实现: 2026-01-02)

### 2.2 知识整理与学习辅助

#### 2.2.1 标签管理
*   用户可为每个节点添加一个或多个自定义标签。
*   标签应支持创建、编辑、删除和搜索。
*   提供标签云或标签列表，方便用户快速筛选和查找相关节点。

#### 2.2.2 搜索功能
*   全局搜索：按关键词搜索所有对话和节点内容（问题、回答、标签）。
*   结果高亮显示。

#### 2.2.3 (V2 考虑) AI 绘制功能集成
*   未来版本可考虑集成 `next-ai-draw-io` 类似的 AI 辅助绘图功能，将节点内容转化为可视化图表。

### 2.3 AI 模型管理与集成

#### 2.3.1 多模型配置
*   用户可在后台配置多种大模型的 API Key (例如 OpenAI, Gemini, Claude)。
*   支持添加、编辑、删除模型配置。

#### 2.3.2 模型选择
*   提问时，界面底部或侧边栏以**模型图标按钮**罗列已添加的 API。
*   鼠标悬浮在图标上显示具体的模型名称和简要信息。
*   支持单选，用户选择后，当前问题将使用该模型。

### 2.4 用户与商业化

#### 2.4.1 用户认证
*   注册、登录（邮箱/密码、OAuth 第三方登录）。

#### 2.4.2 订阅管理
*   **免费用户：** 拥有额度限制（例如，每天/每月对话次数或节点数量），可使用自己的 API Key。
*   **会员用户：** 解锁更高的额度限制，享受 Geminil/OpenAI/Claude 等高级模型的访问权限，更多高级功能。
*   **支付集成：** 通过 Stripe 实现订阅支付、升级/降级、退款等功能。

#### 2.4.3 个人资料与设置
*   用户可管理个人信息、API Key、订阅状态等。

### 2.5 集成式聊天界面 (Integrated Chat)

#### 2.5.1 侧边栏 Tab 整合
*   **设计目的**：将线性对话体验整合进核心导航结构，提供更紧凑、统一的工作流。
*   **布局结构**：
    *   **Tab 导航栏**：侧边栏最左侧或顶部提供图标按钮（如“对话”、“工作区/历史”、“设置”）。
    *   **内容区域**：根据选中的 Tab 动态展示：
        *   **对话线程 (Thread)**：占据侧边栏主体，展示当前线性聊天记录。**显示完整的 AI 回答。** (修改，实现: 2026-01-02)
        *   **底部对话框**：在对话 Tab 下，输入框固定在侧边栏底部，常驻显示。
*   **状态管理**：侧边栏整体支持折叠；在展开状态下，用户可自由切换 Tab 进行交互。

#### 2.5.2 对话交互逻辑
*   **线性追问**：用户在侧边栏底部的输入框提问，AI 在上方的对话线程区实时流式响应。
*   **上下文同步**：当前聊天对话默认与活动工作区关联，为 AI 提供上下文。

#### 2.5.3 “晋升”为画布节点 (Promotion)
*   **核心功能**：聊天界面是“沙盒”，只有被用户选中的内容才会进入画布。
*   **操作**：
    *   在每条消息旁边提供“**添加到画布**”按钮。(提出: 2026-01-02, 实现: 2026-01-02)
    *   点击后，该条消息内容自动在画布当前视口中心创建一个新节点。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **自动连线**：若该消息是针对前一条已晋升的消息的回复，系统应自动在两个画布节点间建立连线。(提出: 2026-01-02, 实现: 2026-01-02)

## 3. UI/UX 考虑 (重点)

### 3.1 视觉风格与主题
*   **暗黑模式 (Dark Mode)**：全站强制使用暗黑主题，以减少长时间使用的视觉疲劳。
    *   **背景色**：深灰色 (例如 `#1e1e1e`)，而非纯黑。
    *   **前景色**：浅灰色文本 (例如 `#e0e0e0`)，高对比度重点色。
    *   **节点样式**：深色背景卡片，带有微弱的阴影和边框，以区分层级。
    *   **文字大小**：问题文本和答案文本保持一致的字体大小（建议 14px 或 16px），保证阅读体验的一致性。

### 3.2 画布交互与导航
*   **无限画布与缩放**：
    *   采用统一容器架构：节点、连线和网格背景应位于同一个可变换的容器 (`#canvas-world`) 内。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **整体缩放**：当用户缩放时，整个容器（包括网格间距、节点大小、连线粗细）应同步缩放，保持视觉一致性。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **视口状态持久化**：
        *   系统应自动记忆用户对每个工作区的平移 (`x`, `y`) 和缩放 (`zoom`) 状态。(提出: 2026-01-02, 实现: 2026-01-02)
        *   当用户重新加载页面或切换工作区时，画布应精准恢复到上次离开时的视口位置。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **网格特性**：
        *   **点大小**：固定为 **2px**。(提出: 2026-01-02, 实现: 2026-01-02)
        *   **点间距 (Gap)**：设定为 **25px**。(提出: 2026-01-02, 实现: 2026-01-02)
        *   **网格颜色**：采用亮色风格，在暗黑背景下清晰可见。(提出: 2026-01-02, 实现: 2026-01-02)
        *   **缩放行为**：背景网格同步内容缩放或保持稳定，以提供最佳的空间参照感。(提出: 2026-01-02, 实现: 2026-01-02)
*   **导航辅助**：
    *   **MiniMap (小地图)**：当用户拖拽移动画布、缩放或滚动时，右下角自动浮现小地图。在停止操作 2 秒后，小地图应自动渐变隐藏。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **缩放控制**：除了鼠标滚轮/触控板缩放外，提供显式的缩放控件（滑块 + 百分比显示）。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **Zoom to Fit**：一键适配视图，调整缩放比例和平移位置，使所有节点恰好完整显示在当前视口中。(提出: 2026-01-02, 实现: 2026-01-02)

### 3.3 界面布局与收纳
*   **Dock 工具栏**：
    *   核心操作按钮（如模型选择、新建节点、Zoom to Fit、Tidy Up 等）放置在画布**正下方悬浮的 Dock 栏**中。(提出: 2026-01-02, 实现: 2026-01-02)
    *   Dock 栏采用玻璃拟态 (Glassmorphism) 或半透明背景，圆角设计，悬浮于画布之上。(提出: 2026-01-02, 实现: 2026-01-02)
*   **可收纳侧边栏 (Tab 导航设计)**：
    *   **交互**：点击侧边栏顶部的折叠按钮，侧边栏宽度从 260px 平滑过渡到 60px。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **Tab 导航**：侧边栏内部划分为 Tab 区域。
        *   **对话 Tab**：提供线性对话流及底部输入框。(提出: 2026-01-02, 实现: 2026-01-02)
        *   **历史/工作区 Tab**：展示过往沟通记录和工作区列表。(提出: 2026-01-02, 实现: 2026-01-02)
        *   **设置 Tab**：配置模型、API Key 等。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **状态**：
        *   **展开态**：显示 Tab 对应的内容、标题、文字标签。(提出: 2026-01-02, 实现: 2026-01-02)
        *   **收起态**：仅显示最左侧的 Tab 图标，隐藏具体内容，最大化画布区域。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **动画**：CSS `transition` 动画时长约 300ms。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **可调节宽度**：侧边栏支持通过拖拽右侧边缘调节宽度，最小宽度 60px (收起状态)，最大宽度 600px。(新增，实现: 2026-01-02)

### 3.4 节点连接视觉方案
*   **核心挑战：** 清晰展示“原答案哪个位置衍生出来的下一个问题”的视觉连线。
*   **方案：**
    *   **高亮锚点**：当鼠标悬停在连接线上时，父节点对应被选中的文本片段应高亮显示（颜色 #FFD700）。
    *   **动态连线**：子节点连接线应智能计算起点，尽量靠近被选中文本所在的行。
    *   **样式区分**：普通对话流使用实线；手动添加的关联使用虚线。

### 3.5 交互反馈
*   **Loading 状态**：AI 生成内容时，节点边框显示呼吸灯效果或进度条。(提出: 2026-01-02, 实现: 2026-01-02)
*   **错误状态**：API 请求失败时，节点背景变红，并显示重试按钮。(提出: 2026-01-02, 实现: 2026-01-02)
*   **平滑过渡**：所有布局变化、节点展开/收起均需包含 200-300ms 的缓动动画。(提出: 2026-01-02, 实现: 2026-01-02)

## 8. 非功能性需求 (NFRs)

### 8.1 性能指标 (Performance)
*   **首屏加载 (FCP)**：< 1.5s (在 4G 网络下)。(提出: 2026-01-02, 实现: 2026-01-02)
*   **数据加载速度**：初始工作区数据（节点与连线）的 API 响应及前端渲染完成应在 **2s 内**实现，理想状态 **< 1s**。(提出: 2026-01-02, 实现: 2026-01-02)
*   **数据一致性与去重**：
    *   **防止重复创建**：前端在发送创建请求前，需验证当前视口或状态中是否已存在具有相同唯一标识的节点。(提出: 2026-01-02, 实现: 2026-01-02)
    *   **幂等 API**：后端 API 应具备幂等性，避免因网络重试导致的重复节点生成。(提出: 2026-01-02, 实现: 2026-01-02)
*   **交互响应 (INP)**：点击节点、展开内容、平移缩放等操作延迟 < 100ms。(提出: 2026-01-02, 实现: 2026-01-02)
*   **画布渲染**：支持同时渲染 100+ 个节点，滚动保持 60fps。(提出: 2026-01-02, 实现: 2026-01-02)
*   **API 延迟**：后端接口平均响应时间 < 200ms (不含 LLM 推理时间)。(提出: 2026-01-02, 实现: 2026-01-02)

### 8.2 安全性 (Security)
*   **数据传输**：全站强制 HTTPS (TLS 1.2+)。(提出: 2026-01-02, 实现: 2026-01-02)
*   **API Key 存储**：用户提供的 LLM API Key 必须在数据库中**加密存储** (AES-256)，且在前端仅显示脱敏信息 (sk-****)。(提出: 2026-01-02, 实现: 2026-01-02)
*   **鉴权**：所有 API 请求需验证 JWT Token，过期时间 7 天，支持自动刷新。(提出: 2026-01-02, 实现: 2026-01-02)
*   **限流 (Rate Limiting)**：针对 IP 和用户 ID 进行限流，防止滥用。(提出: 2026-01-02, 实现: 2026-01-02)

### 8.3 可用性与可靠性
*   **SLA**：目标系统可用性 99.9%。(提出: 2026-01-02, 实现: 2026-01-02)
*   **数据备份**：数据库每日自动全量备份，WAL 日志实时归档，支持按时间点恢复 (PITR)。(提出: 2026-01-02, 实现: 2026-01-02)

## 9. 错误处理与边缘情况

### 9.1 LLM 交互异常
*   **场景**：LLM 响应超时或返回 500 错误。(提出: 2026-01-02, 实现: 2026-01-02)
*   **处理**：前端捕获错误，节点显示红色警告图标。提供“重试”按钮，支持指数退避重试策略。(提出: 2026-01-02, 实现: 2026-01-02)
*   **场景**：流式传输中断。(提出: 2026-01-02, 实现: 2026-01-02)
*   **处理**：保留已接收的内容，并在末尾标记“[连接中断]”，允许用户手动继续生成。(提出: 2026-01-02, 实现: 2026-01-02)

### 9.2 网络异常
*   **场景**：用户网络断开。(提出: 2026-01-02, 实现: 2026-01-02)
*   **处理**：界面显示“离线模式”提示，禁止新的提问操作，但允许浏览已加载内容。网络恢复后自动重连。(提出: 2026-01-02, 实现: 2026-01-02)

### 9.3 额度超限
*   **场景**：免费用户达到每日限制或 Token 耗尽。(提出: 2026-01-02, 实现: 2026-01-02)
*   **处理**：弹出友好的模态框 (Modal)，提示升级 Pro 计划，并提供跳转链接。(提出: 2026-01-02, 实现: 2026-01-02)

## 10. 业务规则与限制

### 10.1 订阅计划限制
| 功能 | Free | Pro | Enterprise |
| :--- | :--- | :--- | :--- |
| 每日节点数 | 50 | 无限 | 无限 |
| 模型支持 | GPT-3.5 | GPT-4, Claude 3, Gemini 1.5 | 全部 + 私有部署模型 |
| 知识库上传 | 不支持 | 支持 (PDF, MD) | 支持 + API 接入 |
| 导出格式 | Markdown | Markdown, PDF, JSON | 全部 |

### 10.2 数据保留
*   免费用户的数据保留 1 年，归档工作区保留 6 个月。
*   Pro 用户数据永久保存。

## 5. 技术选型
*   **前端：** Next.js (React), React Flow, Tailwind CSS, Lucide React, TanStack Query, tRPC。
*   **后端：** Next.js (App Router), Drizzle ORM, Neon DB (PostgreSQL)。
*   **Redis 的作用考量**：
    *   **AI 响应缓存**：对于重复的问题，优先从 Redis 读取缓存的 AI 回复，显著降低 API 消耗和等待时长。
    *   **实时同步与互斥锁**：在多人协作或快速操作时，利用 Redis 保证数据的一致性。
    *   **限流**：精确控制每个用户的并发提问数。
*   **基础设施：** Docker, GitHub Actions, Vercel (前端), AWS/GCP/Azure (后端)。

## 6. 数据模型 (Data Model)

### 6.1 ER 图概念
*   **User** (1) --- (n) **Workspace**
*   **Workspace** (1) --- (n) **Node**
*   **Workspace** (1) --- (n) **Edge**
*   **Node** (n) --- (n) **Tag**

### 6.2 实体定义

#### 6.2.1 User (用户)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | UUID | 主键 |
| `email` | String | 唯一，索引 |
| `password_hash` | String | 加密后的密码 |
| `subscription_tier` | Enum | `FREE`, `PRO`, `ENTERPRISE` |
| `api_keys` | JSON | 用户自定义的 API Key 列表 |
| `created_at` | DateTime | 注册时间 |

#### 6.2.2 Workspace (工作区/对话)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | UUID | 主键 |
| `user_id` | UUID | 外键 -> User.id |
| `title` | String | 默认 "Untitled Workspace" |
| `is_archived` | Boolean | 是否归档 |
| `settings` | JSON | 画布设置（如缩放级别、位置） |
| `created_at` | DateTime | |

#### 6.2.3 Node (节点)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | UUID | 主键 |
| `workspace_id` | UUID | 外键 -> Workspace.id |
| `type` | Enum | `chat`, `note`, `image` (预留) |
| **`summary_question`** | **String** | **最小信息量提问 (50字以内)** (新增，实现: 2026-01-02)|
| **`summary_answer`** | **String** | **最小信息量回答 (100字以内)** (新增，实现: 2026-01-02)|
| `content` | JSON | 包含 **`fullQuestion` (String), `fullAnswer` (String)**, `highlights` (String[]) (修改，实现: 2026-01-02)|
| `position` | JSON | `{x: float, y: float}` (React Flow 坐标) |
| `model_config` | JSON | 使用的模型信息 `{model: "gpt-4", provider: "openai"}` |
| `parent_context_id` | UUID | (可选) 来源节点的 ID，用于追溯 |
| `created_at` | DateTime | |

#### 6.2.4 Edge (连接线)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | UUID | 主键 |
| `workspace_id` | UUID | 外键 -> Workspace.id |
| `source_node_id` | UUID | 外键 -> Node.id |
| `target_node_id` | UUID | 外键 -> Node.id |
| `source_handle` | String | 连接源点的 ID (用于标识从哪段文本引出) |
| `type` | String | 连线样式类型 |

#### 6.2.5 Tag (标签)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | UUID | 主键 |
| `name` | String | 标签名 |
| `color` | String | 标签颜色 (Hex) |

#### 6.2.6 NodeTag (关联表)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `node_id` | UUID | 联合主键 |
| `tag_id` | UUID | 联合主键 |

## 7. API 接口概览 (API Overview)

> 基础 URL: `/api/v1`

### 7.1 认证 (Auth)
*   `POST /auth/register` - 用户注册
*   `POST /auth/login` - 用户登录 (返回 JWT)
*   `GET /auth/me` - 获取当前用户信息

### 7.2 工作区 (Workspaces)
*   `GET /workspaces` - 获取用户的工作区列表
*   `POST /workspaces` - 创建新工作区
*   `GET /workspaces/{id}` - 获取工作区详情（包含所有节点和连线）
*   `PATCH /workspaces/{id}` - 更新工作区（标题、设置）
*   `DELETE /workspaces/{id}` - 删除工作区

### 7.3 节点 (Nodes)
*   `POST /workspaces/{id}/nodes` - 创建新节点 (提问)
    *   Body: `{ question: string, parentId?: string, contextSelection?: string, model: string }`
    *   Response: **JSON { summaryQuestion: string, summaryAnswer: string, fullQuestion: string, fullAnswer: string }** (修改，实现: 2026-01-02)
*   `PATCH /nodes/{id}` - 更新节点内容或位置
*   `DELETE /nodes/{id}` - 删除节点

### 7.4 连线 (Edges)
*   `POST /edges` - 手动创建连线
*   `DELETE /edges/{id}` - 删除连线
